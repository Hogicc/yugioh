<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pigeon Bread Collector</title>
  <style>
    body {
      margin: 0;
      background: #87ceeb;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #a3d9a5;
    }
    #score {
      color: #222;
      font-family: Arial, sans-serif;
      font-size: 24px;
      text-align: center;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div id="score">Breadcrumbs collected: 0</div>
  <canvas id="game" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let pigeonX = 50;
    let pigeonY = canvas.height / 2;
    const pigeonSpeedX = 2;
    const pigeonSpeedY = 4;
    let upPressed = false;
    let downPressed = false;

    let breadcrumbs = [];
    let stories = [];
    let collected = 0;

    function drawPigeon(ctx, x, y) {
      ctx.fillStyle = "#444";
      ctx.fillRect(x, y, 12, 8); // telo
      ctx.fillStyle = "#ccc";
      ctx.fillRect(x + 3, y - 4, 6, 6); // glava
      ctx.fillStyle = "orange";
      ctx.fillRect(x + 9, y - 1, 4, 2); // kljun
    }

    function drawBreadcrumb(ctx, x, y) {
      ctx.fillStyle = "#d2b48c";
      ctx.fillRect(x, y, 6, 6);
    }

    function drawStory(ctx, x, y) {
      ctx.fillStyle = "#800000";
      ctx.fillRect(x, y, 20, 40);
    }

    function createBreadcrumbs() {
      breadcrumbs = [];
      let spacing = 120;
      let startX = 150;
      for (let i = 0; i < 5; i++) {
        let x = startX + i * spacing;
        let y = Math.random() * (canvas.height - 30) + 10;
        breadcrumbs.push({ x, y });
      }
    }

    function createStories() {
      stories = [
        { x: 800, y: 60, dir: -1, speed: 2 },
        { x: 1000, y: 250, dir: -1, speed: 2.5 }
      ];
    }

    function resetGame() {
      pigeonX = 50;
      pigeonY = canvas.height / 2;
      collected = 0;
      createBreadcrumbs();
      createStories();
      document.getElementById("score").textContent = "Breadcrumbs collected: 0";
    }

    function checkCollision() {
      for (let i = 0; i < breadcrumbs.length; i++) {
        let b = breadcrumbs[i];
        if (Math.abs(pigeonX - b.x) < 20 && Math.abs(pigeonY - b.y) < 20) {
          breadcrumbs.splice(i, 1);
          collected++;
          document.getElementById("score").textContent =
            "Breadcrumbs collected: " + collected;
          if (collected % 5 === 0) {
            createBreadcrumbs();
          }
          break;
        }
      }

      for (let s of stories) {
        if (
          Math.abs(pigeonX - s.x) < 20 &&
          Math.abs(pigeonY - s.y) < 30
        ) {
          alert("Dotakao si prepreku! Igra se resetuje.");
          resetGame();
          break;
        }
      }
    }

    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") upPressed = true;
      if (e.key === "ArrowDown") downPressed = true;
    });
    window.addEventListener("keyup", (e) => {
      if (e.key === "ArrowUp") upPressed = false;
      if (e.key === "ArrowDown") downPressed = false;
    });

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (upPressed && pigeonY > 0) pigeonY -= pigeonSpeedY;
      if (downPressed && pigeonY < canvas.height - 20) pigeonY += pigeonSpeedY;

      pigeonX += pigeonSpeedX;
      if (pigeonX > canvas.width + 30) pigeonX = -30;

      drawPigeon(ctx, pigeonX, pigeonY);

      breadcrumbs.forEach((b) => drawBreadcrumb(ctx, b.x, b.y));

      stories.forEach((s) => {
        s.x += s.dir * s.speed;
        if (s.x < -40) s.x = canvas.width + 100;
        drawStory(ctx, s.x, s.y);
      });

      checkCollision();
      requestAnimationFrame(gameLoop);
    }

    resetGame();
    gameLoop();
  </script>
</body>
</html>


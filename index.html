<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pigeon Bread Collector</title>
  <style>
    body {
      margin: 0;
      background: #87ceeb;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #a3d9a5;
    }
    #score {
      color: #222;
      font-family: Arial, sans-serif;
      font-size: 24px;
      text-align: center;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div id="score">Breadcrumbs collected: 0</div>
  <canvas id="game" width="800" height="400"></canvas>

  <script src="sprites.js"></script>
  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const pigeonSpeedX = 2;
    const pigeonSpeedY = 4;
    let pigeonY = canvas.height / 2;
    let pigeonX = 50;

    let upPressed = false;
    let downPressed = false;

    let breadcrumbs = [];
    let collected = 0;

    let stories = [];

    function createBreadcrumbs() {
      breadcrumbs = [];
      let startX = 200;
      let spacing = 90;
      for (let i = 0; i < 5; i++) {
        let x = startX + i * spacing;
        let y = Math.random() * (canvas.height - 20) + 10;
        breadcrumbs.push({ x, y, size: 10 });
      }
    }

    function createStories() {
      stories = [];
      let count = 2 + Math.floor(collected / 10); // više prepreka s više poena
      for (let i = 0; i < count; i++) {
        let y = Math.random() * (canvas.height - 30) + 10;
        let speed = 1.5 + Math.random() * 1 + collected * 0.05;
        stories.push({ x: 800 + i * 150, y, size: 20, dir: -1, speed });
      }
    }

    function resetGame() {
      pigeonY = canvas.height / 2;
      pigeonX = 50;
      collected = 0;
      createBreadcrumbs();
      createStories();
      document.getElementById("score").textContent = "Breadcrumbs collected: 0";
    }

    function checkCollision() {
      for (let i = 0; i < breadcrumbs.length; i++) {
        let b = breadcrumbs[i];
        let distX = Math.abs(pigeonX - b.x);
        let distY = Math.abs(pigeonY - b.y);
        if (distX < 25 && distY < 25) {
          breadcrumbs.splice(i, 1);
          collected++;
          document.getElementById("score").textContent =
            "Breadcrumbs collected: " + collected;
          if (collected % 5 === 0) {
            createBreadcrumbs();
            createStories();
          }
          break;
        }
      }

      for (let story of stories) {
        let distX = Math.abs(pigeonX - story.x);
        let distY = Math.abs(pigeonY - story.y);
        if (distX < 25 && distY < 25) {
          alert("Dotakao si priču! Igra se resetuje.");
          resetGame();
          break;
        }
      }
    }

    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") upPressed = true;
      if (e.key === "ArrowDown") downPressed = true;
    });
    window.addEventListener("keyup", (e) => {
      if (e.key === "ArrowUp") upPressed = false;
      if (e.key === "ArrowDown") downPressed = false;
    });

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (upPressed && pigeonY > 0) pigeonY -= pigeonSpeedY;
      if (downPressed && pigeonY < canvas.height - 30) pigeonY += pigeonSpeedY;

      pigeonX += pigeonSpeedX;
      if (pigeonX > canvas.width + 50) pigeonX = -50;

      drawPigeon(ctx, pigeonX, pigeonY, 1);

      breadcrumbs.forEach((b) => {
        drawBreadcrumb(ctx, b.x, b.y, 1);
      });

      for (let story of stories) {
        story.x += story.dir * story.speed;
        if (story.x < -50) {
          story.x = canvas.width + Math.random() * 100;
          story.y = Math.random() * (canvas.height - 30) + 10;
        }
        drawStory(ctx, story.x, story.y, 1);
      }

      checkCollision();
      requestAnimationFrame(gameLoop);
    }

    resetGame();
    gameLoop();
  </script>
</body>
</html>

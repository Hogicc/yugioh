<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pigeon Bread Collector - Continuous</title>
<style>
  body {
    margin: 0;
    background: #87ceeb;
    overflow: hidden;
  }
  canvas {
    display: block;
    margin: auto;
    background: #a3d9a5;
  }
  #score {
    color: #222;
    font-family: Arial, sans-serif;
    font-size: 24px;
    text-align: center;
    margin: 10px;
  }
</style>
</head>
<body>
<div id="score">Breadcrumbs collected: 0</div>
<canvas id="game" width="800" height="400"></canvas>

<script src="sprites.js"></script>
<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const pigeonSpeedX = 2;
  const pigeonSpeedY = 4;
  let pigeonY = canvas.height / 2;
  let pigeonX = 50;

  let upPressed = false;
  let downPressed = false;

  // MRVICE
  let breadcrumbs = [];
  let collected = 0;

  // PRICE
  let stories = [];

  // PREPREKE (izabrao sam ih da budu crveni kvadrati, mogu se menjati)
  let obstacles = [];

  // Kreiranje 5 mrvica u random visini i rasporedu u X
  function createBreadcrumbs() {
    breadcrumbs = [];
    let startX = 300;
    for (let i = 0; i < 5; i++) {
      let x = startX + i * 140;
      let y = Math.random() * (canvas.height - 20) + 10;
      breadcrumbs.push({ x, y, size: 10 });
    }
  }

  // Dodavanje dodatnih mrvica na desnoj strani (beskonačno)
  function addMoreBreadcrumbs(count) {
    let maxX = 0;
    breadcrumbs.forEach(b => {
      if (b.x > maxX) maxX = b.x;
    });
    for (let i = 1; i <= count; i++) {
      let x = maxX + i * 140;
      let y = Math.random() * (canvas.height - 20) + 10;
      breadcrumbs.push({ x, y, size: 10 });
    }
  }

  // Kreiranje 2 price koje se pomeraju horizontalno levo-desno
  function createStories() {
    stories = [];
    stories.push({ x: 800, y: 50, size: 20, dir: -1, speed: 1.5 }); // ide levo
    stories.push({ x: 800, y: 300, size: 20, dir: -1, speed: 2 });  // ide levo brže
  }

  // Kreiranje prepreka koje stoje na mestu (crveni kvadrati)
  function createObstacles() {
    obstacles = [];
    obstacles.push({ x: 600, y: 150, size: 30 });
    obstacles.push({ x: 1000, y: 250, size: 30 });
  }

  createBreadcrumbs();
  createStories();
  createObstacles();

  function resetGame() {
    pigeonY = canvas.height / 2;
    pigeonX = 50;
    collected = 0;
    createBreadcrumbs();
    createStories();
    createObstacles();
    document.getElementById("score").textContent = "Breadcrumbs collected: 0";
  }

  // Provera sudara goluba sa mrvicama, pricama i preprekama
  function checkCollision() {
    // Mrvice
    for (let i = 0; i < breadcrumbs.length; i++) {
      let b = breadcrumbs[i];
      let distX = Math.abs(pigeonX - b.x);
      let distY = Math.abs(pigeonY - b.y);
      if (distX < 25 && distY < 25) {
        breadcrumbs.splice(i, 1);
        collected++;
        document.getElementById("score").textContent = "Breadcrumbs collected: " + collected;

        // Kad pokupi 5 mrvica, dodaj novih 5 na desnu stranu
        if (collected % 5 === 0) {
          addMoreBreadcrumbs(5);
        }
        break;
      }
    }

    // Price (ako dodirneš priču, ideš ispočetka)
    for (let story of stories) {
      let distX = Math.abs(pigeonX - story.x);
      let distY = Math.abs(pigeonY - story.y);
      if (distX < 25 && distY < 25) {
        alert("Dotakao si priču! Igra se resetuje.");
        resetGame();
        break;
      }
    }

    // Prepreke (ako dodirneš prepreku, ideš ispočetka)
    for (let obstacle of obstacles) {
      let distX = Math.abs(pigeonX - obstacle.x);
      let distY = Math.abs(pigeonY - obstacle.y);
      if (distX < 25 && distY < 25) {
        alert("Udario si u prepreku! Igra se resetuje.");
        resetGame();
        break;
      }
    }
  }

  // Event listeneri za strelice gore-dole
  window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowUp") upPressed = true;
    if (e.key === "ArrowDown") downPressed = true;
  });
  window.addEventListener("keyup", (e) => {
    if (e.key === "ArrowUp") upPressed = false;
    if (e.key === "ArrowDown") downPressed = false;
  });

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Golub se pomera gore/dole po pritisku strelica
    if (upPressed && pigeonY > 0) {
      pigeonY -= pigeonSpeedY;
    }
    if (downPressed && pigeonY < canvas.height - 30) {
      pigeonY += pigeonSpeedY;
    }

    // Golub se stalno pomera desno
    pigeonX += pigeonSpeedX;
    if (pigeonX > canvas.width + 50) {
      pigeonX = -50;
    }

    // Crtanje svih objekata
    drawPigeon(ctx, pigeonX, pigeonY, 1);

    breadcrumbs.forEach(b => {
      drawBreadcrumb(ctx, b.x, b.y, 1);
    });

    // Pomeraj i crtanje priča
    for (let story of stories) {
      story.x += story.dir * story.speed;
      if (story.x < -50) {
        story.x = canvas.width + 50; // ponovo sa desne strane
      }
      drawStory(ctx, story.x, story.y, 1);
    }

    // Crtanje prepreka (crveni kvadrati)
    obstacles.forEach(o => {
      ctx.fillStyle = "#d63031";
      ctx.fillRect(o.x - o.size/2, o.y - o.size/2, o.size, o.size);
    });

    checkCollision();

    requestAnimationFrame(gameLoop);
  }

  resetGame();
  gameLoop();
</script>
</body>
</html>


